{% extends "base.html" %} {% load static %} {% block title %}Weekly Meal Planner | Meal Prep Codex{% endblock %} {% block extra_css %}
<link rel="stylesheet" href="{% static 'css/preepweek.css' %}" />
{% endblock %} {% block content %}

<div class="container">
  <div class="header">
    <h1 class="text-3xl font-bold">Weekly Meal Planner</h1>
    <div>
      <button class="btn">💾 Save Plan</button>
      <button class="btn secondary" onclick="openProfileModal()">🧍 Set Profile</button>
    </div>
  </div>

  <div class="prep-options">
    <div class="prep-option active">🔁 Cook each day</div>
    <div class="prep-option">📦 Prep for 2 days</div>
    <div class="prep-option">🧊 Prep for whole week</div>
    <button class="btn secondary" style="margin-left: auto">🕐 Show Prep Days</button>
  </div>

  <div class="action-buttons">
    <button class="btn secondary" onclick="openPreferencesModal()">⚙ Preferences</button>
    <button class="btn" id="generate-grocery">🧾 Generate Grocery List</button>
    <button class="btn secondary">⏱ Copy to Next Day</button>
    <button class="btn secondary">🧹 Clear All</button>
    <button class="btn secondary">🖨 Print / PDF</button>
  </div>

  <div class="calendar">
    <!-- Day headers -->
    <div class="day-header">Monday</div>
    <div class="day-header">Tuesday</div>
    <div class="day-header">Wednesday</div>
    <div class="day-header">Thursday</div>
    <div class="day-header">Friday</div>
    <div class="day-header">Saturday</div>
    <div class="day-header">Sunday</div>

    <!-- Breakfast slots -->
    <div class="meal-slot" data-slot-id="1">
      <div class="meal-time">Breakfast</div>
      <a href="{% url 'recipe_detail' recipes.1.id %}" class="transform transition-transform hover:scale-105">
        <div class="meal-content">{{ recipes.1.title}}</div>
      </a>
      <button class="add-meal">✏️ Edit</button>
    </div>
    <div class="meal-slot empty" data-slot-id="2">
      <button class="add-meal">+ Add Meal</button>
    </div>
    <div class="meal-slot" data-slot-id="3">
      <div class="meal-time">Breakfast</div>
      <div class="meal-content">Greek yogurt with granola</div>
      <button class="add-meal">✏️ Edit</button>
    </div>
    <div class="meal-slot empty" data-slot-id="4">
      <button class="add-meal">+ Add Meal</button>
    </div>
    <div class="meal-slot" data-slot-id="5">
      <div class="meal-time">Breakfast</div>
      <div class="meal-content">Oatmeal with berries</div>
      <button class="add-meal">✏️ Edit</button>
    </div>
    <div class="meal-slot" data-slot-id="6">
      <div class="meal-time">Breakfast</div>
      <div class="meal-content">Pancakes</div>
      <button class="add-meal">✏️ Edit</button>
    </div>
    <div class="meal-slot empty" data-slot-id="7">
      <button class="add-meal">+ Add Meal</button>
    </div>

    <!-- Lunch slots -->
    <div class="meal-slot connected" data-slot-id="8">
      <div class="meal-time">Lunch</div>
      <div class="meal-content">Chicken Caesar salad</div>
      <button class="add-meal">✏️ Edit</button>
    </div>
    <div class="meal-slot connected reused-meal" data-source-day="Monday" data-slot-id="9">
      <div class="meal-time">Lunch <span class="source-tag">(from Monday)</span></div>
      <div class="meal-content">Chicken Caesar salad</div>
      <button class="add-meal">✏️ Edit</button>
    </div>

    <div class="meal-slot" data-slot-id="10">
      <div class="meal-time">Lunch</div>
      <div class="meal-content">Turkey sandwich</div>
      <button class="add-meal">✏️ Edit</button>
    </div>
    <div class="meal-slot" data-slot-id="11">
      <div class="meal-time">Lunch</div>
      <div class="meal-content">Vegetable stir fry</div>
      <button class="add-meal">✏️ Edit</button>
    </div>
    <div class="meal-slot empty" data-slot-id="12">
      <button class="add-meal">+ Add Meal</button>
    </div>
    <div class="meal-slot" data-slot-id="13">
      <div class="meal-time">Lunch</div>
      <div class="meal-content">Pasta salad</div>
      <button class="add-meal">✏️ Edit</button>
    </div>
    <div class="meal-slot empty" data-slot-id="14">
      <button class="add-meal">+ Add Meal</button>
    </div>

    <!-- Dinner slots -->
    <div class="meal-slot" data-slot-id="15">
      <div class="meal-time">Dinner</div>
      <div class="meal-content">Grilled salmon with veggies</div>
      <button class="add-meal">✏️ Edit</button>
    </div>
    <div class="meal-slot" data-slot-id="16">
      <div class="meal-time">Dinner</div>
      <div class="meal-content">Beef tacos</div>
      <button class="add-meal">✏️ Edit</button>
    </div>
    <div class="meal-slot empty" data-slot-id="17">
      <button class="add-meal">+ Add Meal</button>
    </div>
    <div class="meal-slot" data-slot-id="18">
      <div class="meal-time">Dinner</div>
      <div class="meal-content">Chicken curry</div>
      <button class="add-meal">✏️ Edit</button>
    </div>
    <div class="meal-slot empty" data-slot-id="19">
      <button class="add-meal">+ Add Meal</button>
    </div>
    <div class="meal-slot" data-slot-id="20">
      <div class="meal-time">Dinner</div>
      <div class="meal-content">Pizza night</div>
      <button class="add-meal">✏️ Edit</button>
    </div>
    <div class="meal-slot empty" data-slot-id="21">
      <button class="add-meal">+ Add Meal</button>
    </div>

    <!-- In your calendar grid, after lunch slots and before dinner slots, add: -->
    <!-- Nutrient Summary Slots -->
    <div class="meal-slot nutrient-summary">
      <div class="nutrient-day">
        <div class="nutrient-item">Calories: 1850kcal</div>
        <div class="nutrient-bar">
          <div class="nutrient-progress nutrient-optimal" style="width: 92%"></div>
        </div>
      </div>
    </div>
    <div class="meal-slot nutrient-summary">
      <div class="nutrient-day">
        <div class="nutrient-item">Calories: 1720kcal</div>
        <div class="nutrient-bar">
          <div class="nutrient-progress nutrient-optimal" style="width: 86%"></div>
        </div>
      </div>
    </div>
    <!-- Add 5 more for each day -->
    <div class="meal-slot nutrient-summary">
      <div class="nutrient-day">
        <div class="nutrient-item">Calories: 1850kcal</div>
        <div class="nutrient-bar">
          <div class="nutrient-progress nutrient-optimal" style="width: 92%"></div>
        </div>
      </div>
    </div>
    <div class="meal-slot nutrient-summary">
      <div class="nutrient-day">
        <div class="nutrient-item">Calories: 1720kcal</div>
        <div class="nutrient-bar">
          <div class="nutrient-progress nutrient-optimal" style="width: 86%"></div>
        </div>
      </div>
    </div>
    <div class="meal-slot nutrient-summary">
      <div class="nutrient-day">
        <div class="nutrient-item">Calories: 1850kcal</div>
        <div class="nutrient-bar">
          <div class="nutrient-progress nutrient-optimal" style="width: 92%"></div>
        </div>
      </div>
    </div>
    <div class="meal-slot nutrient-summary">
      <div class="nutrient-day">
        <div class="nutrient-item">Calories: 1720kcal</div>
        <div class="nutrient-bar">
          <div class="nutrient-progress nutrient-optimal" style="width: 86%"></div>
        </div>
      </div>
    </div>
    <div class="meal-slot nutrient-summary">
      <div class="nutrient-day">
        <div class="nutrient-item">Calories: 1720kcal</div>
        <div class="nutrient-bar">
          <div class="nutrient-progress nutrient-optimal" style="width: 86%"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Meal Selection Modal -->
<div id="meal-modal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center p-4">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto">
    <!-- Modal Header -->
    <div class="flex justify-between items-center p-6 border-b">
      <h2 class="text-2xl font-bold text-gray-800">Select a Meal</h2>
      <button class="close-modal text-3xl text-gray-500 hover:text-gray-700">&times;</button>
    </div>
    
    <!-- Modal Body -->
    <div class="p-6">
      <!-- Filter -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">Filter by:</label>
        <select id="meal-filter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
          <option value="all">All Types</option>
          <option value="chicken">🍗 Chicken</option>
          <option value="beef">🥩 Beef</option>
          <option value="fish">🐟 Fish</option>
          <option value="vegan">🥦 Vegan</option>
          <option value="pasta">🍝 Pasta</option>
        </select>
      </div>

      <!-- Meal Options Grid -->
      <div id="meal-options" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6 hidden">
        <!-- Dynamically populated from localStorage -->
      </div>

      <!-- Empty State -->
      <div id="empty-meals-message" class="text-center py-8 px-4 bg-gray-50 rounded-lg">
        <div class="text-5xl mb-4">🍽️</div>
        <h3 class="text-xl font-semibold text-gray-800 mb-2">Meal list is empty!</h3>
        <p class="text-gray-600 mb-4">Go to recipes and add them to favorites</p>
        <a href="{% url 'recipe_list' %}" class="inline-block px-6 py-2 bg-orange-500 text-white font-medium rounded-lg hover:bg-orange-600 transition-colors">
          Browse Recipes
        </a>
      </div>
    </div>
    
    <!-- Modal Footer -->
    <div class="p-6 border-t">
      <button class="w-full py-3 px-4 bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium rounded-lg transition-colors">
        View Recipe Details
      </button>
    </div>
  </div>
</div>

<!-- Grocery List Sidebar -->
<div class="grocery-sidebar" id="grocery-sidebar">
  <span class="close-modal" onclick="closeGrocerySidebar()">×</span>
  <h2>Grocery List</h2>

  <div class="grocery-category">
    <h3>Produce</h3>
    <div class="grocery-item">
      <span>Tomatoes</span>
      <span>4</span>
    </div>
    <div class="grocery-item">
      <span>Lettuce</span>
      <span>1 head</span>
    </div>
    <div class="grocery-item">
      <span>Bell peppers</span>
      <span>3</span>
    </div>
  </div>

  <div class="grocery-category">
    <h3>Meat & Fish</h3>
    <div class="grocery-item">
      <span>Chicken breast</span>
      <span>2 lbs</span>
    </div>
    <div class="grocery-item">
      <span>Ground beef</span>
      <span>1 lb</span>
    </div>
    <div class="grocery-item">
      <span>Salmon fillet</span>
      <span>1 lb</span>
    </div>
  </div>

  <div class="grocery-category">
    <h3>Dairy</h3>
    <div class="grocery-item">
      <span>Eggs</span>
      <span>12</span>
    </div>
    <div class="grocery-item">
      <span>Milk</span>
      <span>1 gal</span>
    </div>
    <div class="grocery-item">
      <span>Cheese</span>
      <span>8 oz</span>
    </div>
  </div>

  <button class="btn" style="width: 100%; margin-top: 15px">Print List</button>
</div>

<div id="profile-modal" class="modal">
  <div class="modal-content bg-white rounded-lg shadow-lg overflow-hidden">
    <span class="close-modal top-0 right-0 p-4" onclick="closeProfileModal()">×</span>
    <h2 class="text-2xl font-bold text-center">Daily Calorie Intake Calculator</h2>
    <p class="text-center">For accurate calculation, we need some basic info about you</p>

    <form id="profile-form" class="space-y-4 p-4">
      <label class="block"> 1. What is your sex? </label>
      <div class="flex space-x-4">
        <label class="flex items-center">
          <input type="radio" name="sex" value="male" required class="mr-2" />
          Male
        </label>
        <label class="flex items-center">
          <input type="radio" name="sex" value="female" class="mr-2" />
          Female
        </label>
      </div>

      <label class="block"> 2. How old are you? </label>
      <input type="number" name="age" required class="w-full px-4 py-2 border rounded-md" />

      <label class="block"> 3. How tall are you? </label>
      <input type="number" name="height" required class="w-full px-4 py-2 border rounded-md" />

      <label class="block"> 4. How much do you weigh? </label>
      <input type="number" name="weight" required class="w-full px-4 py-2 border rounded-md" />

      <label class="block"> 5. How active are you on a daily basis? </label>
      <select name="activity" required class="w-full px-4 py-2 border rounded-md">
        <option value="1.2">Lightly active (mostly sitting)</option>
        <option value="1.375">Moderately active (mostly standing)</option>
        <option value="1.55">Active (mostly walking)</option>
        <option value="1.725">Very active (physically demanding)</option>
      </select>

      <button type="submit" class="w-full px-4 py-2 bg-blue-500 text-white rounded-md">Calculate Calories</button>
    </form>

    <div id="calorie-result" class="p-4 text-xl font-bold text-center"></div>
  </div>
</div>

<div class="modal" id="preferences-modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closePreferencesModal()">×</span>
    <h2>Meal Preferences</h2>

    <div class="preference-section">
      <h3>Protein Preferences</h3>
      <div class="preference-options">
        <label><input type="checkbox" name="protein" value="chicken" checked /> 🍗 Chicken</label>
        <label><input type="checkbox" name="protein" value="beef" checked /> 🥩 Beef</label>
        <label><input type="checkbox" name="protein" value="fish" checked /> 🐟 Fish</label>
        <label><input type="checkbox" name="protein" value="pork" checked /> 🐖 Pork</label>
        <label><input type="checkbox" name="protein" value="vegan" /> 🥦 Vegan</label>
        <label><input type="checkbox" name="protein" value="vegetarian" /> 🥬 Vegetarian</label>
      </div>
    </div>

    <div class="preference-section">
      <h3>Carb Preferences</h3>
      <div class="preference-options">
        <label><input type="checkbox" name="carb" value="rice" checked /> 🍚 Rice</label>
        <label><input type="checkbox" name="carb" value="pasta" checked /> 🍝 Pasta</label>
        <label><input type="checkbox" name="carb" value="potato" checked /> 🥔 Potato</label>
        <label><input type="checkbox" name="carb" value="bread" checked /> 🍞 Bread</label>
        <label><input type="checkbox" name="carb" value="quinoa" /> 🌾 Quinoa</label>
      </div>
    </div>

    <div class="preference-section">
      <h3>Banned Ingredients</h3>
      <div class="preference-options">
        <div class="banned-ingredients-input">
          <input type="text" id="new-banned-ingredient" placeholder="Add ingredient to ban" />
          <button class="btn secondary" onclick="addBannedIngredient()">Add</button>
        </div>
        <div id="banned-ingredients-list" class="banned-ingredients-list">
          <!-- Dynamically populated -->
        </div>
      </div>
    </div>

    <div class="preference-section">
      <h3>Other Preferences</h3>
      <div class="preference-options">
        <label><input type="checkbox" name="preference" value="quick" /> ⏱ Quick meals only (&lt;30 min)</label>
        <label><input type="checkbox" name="preference" value="low-carb" /> 🍃 Low-carb options</label>
        <label><input type="checkbox" name="preference" value="high-protein" /> 💪 High-protein</label>
        <label><input type="checkbox" name="preference" value="gluten-free" /> 🌾 Gluten-free</label>
        <label><input type="checkbox" name="preference" value="dairy-free" /> 🥛 Dairy-free</label>
      </div>
    </div>

    <button class="btn" onclick="savePreferences()" style="margin-top: 20px">Save Preferences</button>
  </div>
</div>

<h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">{{recipes.7.title}}</h2>

<div class="max-w-5xl mx-auto px-4 py-8">
  <!-- Latest Recipes Section -->
  <section class="mb-10">
    <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Latest Recipes</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      {% for recipe in recipes %}
      <a href="{% url 'recipe_detail' recipe.id %}" class="transform transition-transform hover:scale-105">
        <div class="bg-orange-50 shadow-lg rounded-lg overflow-hidden flex flex-col h-full">
          <!-- Recipe Image -->
          {% if recipe.image %}
          <img src="{{ recipe.image_card.url }}" alt="{{ recipe.title }}" class="w-full h-32 sm:h-36 lg:h-40 object-cover" />
          {% else %}
          <div class="h-32 sm:h-36 lg:h-40 bg-gray-300 flex items-center justify-center">
            <p class="text-gray-500">No Image Available</p>
          </div>
          {% endif %}

          <!-- Recipe Details -->
          <div class="p-4 flex-grow flex flex-col">
            <h3 class="text-lg font-semibold text-gray-800 truncate">{{ recipe.title }}</h3>
            <p class="text-sm text-gray-500 mb-2">{{ recipe.activate_date|date:"F d, Y" }}</p>
            <p class="text-gray-700 mt-2 line-clamp-3">{{ recipe.description|truncatewords:20 }}</p>
          </div>
        </div>
      </a>
      {% endfor %}
    </div>
  </section>
</div>

{% endblock %} {% block extra_js %}
<script src="{% static 'js/preepweek.js' %}"></script>
{% endblock %}
