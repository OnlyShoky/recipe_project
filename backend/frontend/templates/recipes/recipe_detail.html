{% extends 'base.html' %} {% load custom_filters %} {% block title %}{{ recipe.title }}{% endblock %} {% block content %}
<div class="bg-sepia-100 shadow-md rounded-lg p-4 md:p-6 mb-8 flex flex-col md:flex-row justify-between relative">
  <!-- Recipe Information (Title, Description, Tags, Times) -->
  <div class="w-full md:w-7/12">
    <!-- Recipe Title -->
    <div class="flex justify-between items-start mb-4">
      <h1 class="text-2xl md:text-3xl font-bold text-gray-800">{{ recipe.title }}</h1>

      <!-- Favorite Button - Better placement near title -->
      <button id="favorite-btn" class="absolute top-0 right-0 m-[0.5rem] flex items-center gap-1 px-3 py-1 bg-orange-200 hover:bg-orange-300 text-gray-800 shadow-md hover:shadow-lg transition-shadow flex font-bold py-1 px-3 rounded-full flex items-center" onclick="toggleFavorite()">
        <span class="bg-orange-200 hover:bg-orange-300 text-gray-800 font-bold py-1 px-3 rounded-full flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" x="0px" y="0px" width="1.5rem" height="1.5rem" viewBox="25 0 500 550"><path fill="currentColor" d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z" /></svg>
        </span>
        <span class="text-sm hidden md:inline">Save</span>
      </button>

    </div>

    <script>
      // Convert current recipe to JS object
      const currentRecipe = {
        title: "{{ recipe.title|escapejs }}",
        id: "{{ recipe.id }}",
        url: "{% url 'recipe_detail' recipe.id %}",
        image: "{% if recipe.image %}{{ recipe.image_card.url|escapejs }}{% else %}null{% endif %}",
        description: "{{ recipe.description|escapejs|truncatechars:100 }}",
        prep_time: "{{ recipe.prep_time }}",
        total_time: "{{ recipe.total_time }}",
        nutrition: {
          calories: "{{ recipe.nutrition.calories }}",
          protein: "{{ recipe.nutrition.protein }}",
          carbs: "{{ recipe.nutrition.carbs }}",
          fat: "{{ recipe.nutrition.fat }}",
        },
      };

      console.log(currentRecipe);

      // Check if recipe is already favorited
      function isRecipeFavorited() {
        const favorites = JSON.parse(localStorage.getItem("favoriteRecipes") ?? "[]");
        console.log("favorites", favorites);

        return favorites.some((fav) => fav.id === currentRecipe.id);
      }

      // Update button appearance
      function updateFavoriteButton() {
        const btn = document.getElementById("favorite-btn");
        if (isRecipeFavorited()) {
          btn.innerHTML = `<span class="text-sepia-light p-1">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" x="0px" y="0px" width="1rem" height="1rem" viewBox="25 0 500 550"><path fill="currentColor" d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z" /></svg>
        </span>
        `;
        } else {
          btn.innerHTML = `<span class="text-sepia-light p-1">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" x="0px" y="0px" width="1rem" height="1rem" viewBox="25 0 500 550"><path fill="currentColor" d="M287.9 0c9.2 0 17.6 5.2 21.6 13.5l68.6 141.3 153.2 22.6c9 1.3 16.5 7.6 19.3 16.3s.5 18.1-5.9 24.5L433.6 328.4l26.2 155.6c1.5 9-2.2 18.1-9.7 23.5s-17.3 6-25.3 1.7l-137-73.2L151 509.1c-8.1 4.3-17.9 3.7-25.3-1.7s-11.2-14.5-9.7-23.5l26.2-155.6L31.1 218.2c-6.5-6.4-8.7-15.9-5.9-24.5s10.3-14.9 19.3-16.3l153.2-22.6L266.3 13.5C270.4 5.2 278.7 0 287.9 0zm0 79L235.4 187.2c-3.5 7.1-10.2 12.1-18.1 13.3L99 217.9 184.9 303c5.5 5.5 8.1 13.3 6.8 21L171.4 443.7l105.2-56.2c7.1-3.8 15.6-3.8 22.6 0l105.2 56.2L384.2 324.1c-1.3-7.7 1.2-15.5 6.8-21l85.9-85.1L358.6 200.5c-7.8-1.2-14.6-6.1-18.1-13.3L287.9 79z" /></svg>
        </span>
        `;
        }
      }

      // Toggle favorite status
      function toggleFavorite() {
        let favorites = JSON.parse(localStorage.getItem("favoriteRecipes") || "[]");
        if (isRecipeFavorited()) {
          // Remove from favorites
          favorites = favorites.filter((fav) => fav.id !== currentRecipe.id);
        } else {
          // Add to favorites
          favorites.push(currentRecipe);
        }

        localStorage.setItem("favoriteRecipes", JSON.stringify(favorites));
        updateFavoriteButton();
      }

      // Initialize button state
      document.addEventListener("DOMContentLoaded", updateFavoriteButton);
    </script>

    <!-- Metadata -->
    <p class="text-sm text-gray-500 mb-4">Published: {{ recipe.activate_date|date:"F d, Y" }}</p>

    <!-- Recipe Description -->
    <p class="text-gray-700 mb-6">{{ recipe.description }}</p>

    <!-- Course and Cuisine -->
    <div class="flex flex-col mb-6">
      <div class="flex items-center space-x-2 mb-3">
        <span class="text-sepia-light">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" x="0px" y="0px" width="16px" height="16px" viewBox="25 0 500 550"><path fill="currentColor" d="M0 192c0-35.3 28.7-64 64-64c.5 0 1.1 0 1.6 0C73 91.5 105.3 64 144 64c15 0 29 4.1 40.9 11.2C198.2 49.6 225.1 32 256 32s57.8 17.6 71.1 43.2C339 68.1 353 64 368 64c38.7 0 71 27.5 78.4 64c.5 0 1.1 0 1.6 0c35.3 0 64 28.7 64 64c0 11.7-3.1 22.6-8.6 32L8.6 224C3.1 214.6 0 203.7 0 192zm0 91.4C0 268.3 12.3 256 27.4 256l457.1 0c15.1 0 27.4 12.3 27.4 27.4c0 70.5-44.4 130.7-106.7 154.1L403.5 452c-2 16-15.6 28-31.8 28l-231.5 0c-16.1 0-29.8-12-31.8-28l-1.8-14.4C44.4 414.1 0 353.9 0 283.4z" /></svg>
        </span>
        <p class="text-gray-600 font-medium"><strong>Course:</strong> {{ recipe.courses.all | join:', ' }}</p>
      </div>
      <div class="flex items-center space-x-2 mb-3">
        <span class="text-sepia-light">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" x="0px" y="0px" width="16px" height="16px" viewBox="25 0 500 550">
            <path fill="currentColor" d="M57.7 193l9.4 16.4c8.3 14.5 21.9 25.2 38 29.8L163 255.7c17.2 4.9 29 20.6 29 38.5l0 39.9c0 11 6.2 21 16 25.9s16 14.9 16 25.9l0 39c0 15.6 14.9 26.9 29.9 22.6c16.1-4.6 28.6-17.5 32.7-33.8l2.8-11.2c4.2-16.9 15.2-31.4 30.3-40l8.1-4.6c15-8.5 24.2-24.5 24.2-41.7l0-8.3c0-12.7-5.1-24.9-14.1-33.9l-3.9-3.9c-9-9-21.2-14.1-33.9-14.1L257 256c-11.1 0-22.1-2.9-31.8-8.4l-34.5-19.7c-4.3-2.5-7.6-6.5-9.2-11.2c-3.2-9.6 1.1-20 10.2-24.5l5.9-3c6.6-3.3 14.3-3.9 21.3-1.5l23.2 7.7c8.2 2.7 17.2-.4 21.9-7.5c4.7-7 4.2-16.3-1.2-22.8l-13.6-16.3c-10-12-9.9-29.5 .3-41.3l15.7-18.3c8.8-10.3 10.2-25 3.5-36.7l-2.4-4.2c-3.5-.2-6.9-.3-10.4-.3C163.1 48 84.4 108.9 57.7 193zM464 256c0-36.8-9.6-71.4-26.4-101.5L412 164.8c-15.7 6.3-23.8 23.8-18.5 39.8l16.9 50.7c3.5 10.4 12 18.3 22.6 20.9l29.1 7.3c1.2-9 1.8-18.2 1.8-27.5zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256z" />
          </svg>
        </span>
        <p class="text-gray-600 font-medium"><strong>Cuisine:</strong> {{ recipe.cuisines.all | join:', ' }}</p>
      </div>
      <div class="flex flex-wrap space-y-2 items-center space-x-2 mb-3">
        <span class="text-sepia-light">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" x="0px" y="0px" width="16px" height="16px" viewBox="25 0 500 550">
            <path fill="currentColor" d="M345 39.1L472.8 168.4c52.4 53 52.4 138.2 0 191.2L360.8 472.9c-9.3 9.4-24.5 9.5-33.9 .2s-9.5-24.5-.2-33.9L438.6 325.9c33.9-34.3 33.9-89.4 0-123.7L310.9 72.9c-9.3-9.4-9.2-24.6 .2-33.9s24.6-9.2 33.9 .2zM0 229.5L0 80C0 53.5 21.5 32 48 32l149.5 0c17 0 33.3 6.7 45.3 18.7l168 168c25 25 25 65.5 0 90.5L277.3 442.7c-25 25-65.5 25-90.5 0l-168-168C6.7 262.7 0 246.5 0 229.5zM144 144a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z" />
          </svg>
        </span>
        <p class="text-gray-600 font-medium"><strong>Tags:</strong></p>
        {% for tag in recipe.tags.all %}
        <!-- Limit to 8 ingredients -->
        <a href="{% url 'recipe_list' %}?tag={{ tag.name }}" class="transform transition-transform hover:scale-105">
          <div class="bg-orange-200 px-2 py-0.5 shadow rounded-lg text-center hover:shadow-lg transition-shadow flex items-center justify-center">
            <p class="text-black font-semibold">{{ tag }}</p>
          </div>
        </a>
        {% endfor %}
      </div>
    </div>

    <!-- Times (Prep, Cook, Cool, Total) -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-6">
      {% if recipe.prep_time %}
      <div class="flex items-center space-x-2">
        <span class="text-sepia-light">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="16px" height="16px" viewBox="0 0 24 24">
            <g>
              <path fill="currentColor" d="M4.3,16.6l-2.2,2.2c-0.6,0.6-0.9,1.3-0.9,2.1c0,0.8,0.3,1.6,0.9,2.1s1.3,0.9,2.1,0.9c0.8,0,1.6-0.3,2.1-0.9l2.2-2.2L4.3,16.6z"></path>
              <path fill="currentColor" d="M22.6,5.4l-3.5-3.5c-1.1-1.1-2.6-1.8-4.2-1.8s-3.1,0.6-4.2,1.8l-8.4,8.4c-0.4,0.4-0.4,1,0,1.4l7.1,7.1C9.5,18.9,9.7,19,10,19c0,0,0,0,0,0c0.3,0,0.5-0.1,0.7-0.3L22.6,6.8C23,6.4,23,5.8,22.6,5.4z M9.2,14.6l-1.4-1.4l6.4-6.4l1.4,1.4L9.2,14.6z"></path>
            </g>
          </svg>
        </span>
        <p class="text-gray-600 font-medium"><strong>Prep Time:</strong> {{ recipe.prep_time|duration_format }}</p>
      </div>
      {% endif %} {% if recipe.cook_time %}

      <div class="flex items-center space-x-2">
        <span class="text-sepia-light">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="16px" height="16px" viewBox="0 0 24 24">
            <g>
              <path fill="currentColor" d="M9,9c0.6,0,1-0.4,1-1V4c0-0.6-0.4-1-1-1S8,3.4,8,4v4C8,8.6,8.4,9,9,9z"></path>
              <path fill="currentColor" d="M4,12c0.6,0,1-0.4,1-1V7c0-0.6-0.4-1-1-1S3,6.4,3,7v4C3,11.6,3.4,12,4,12z"></path>
              <path fill="currentColor" d="M14,12c0.6,0,1-0.4,1-1V7c0-0.6-0.4-1-1-1s-1,0.4-1,1v4C13,11.6,13.4,12,14,12z"></path>
              <path fill="currentColor" d="M23,14h-5H1c-0.6,0-1,0.4-1,1v3c0,1.7,1.3,3,3,3h13c1.7,0,3-1.3,3-3v-1h4c0.6,0,1-0.4,1-1v-1C24,14.4,23.6,14,23,14z"></path>
            </g>
          </svg>
        </span>
        <p class="text-gray-600 font-medium"><strong>Cook Time:</strong> {{ recipe.cook_time|duration_format }}</p>
      </div>
      {% endif %} {% if recipe.cool_time %}
      <div class="flex items-center space-x-2">
        <span class="text-sepia-light">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" x="0px" y="0px" width="16px" height="16px" viewBox="25 0 500 550">
            <path fill="currentColor" d="M128 112c0-26.5 21.5-48 48-48s48 21.5 48 48l0 164.5c0 17.3 7.1 31.9 15.3 42.5C249.8 332.6 256 349.5 256 368c0 44.2-35.8 80-80 80s-80-35.8-80-80c0-18.5 6.2-35.4 16.7-48.9c8.2-10.6 15.3-25.2 15.3-42.5L128 112zM176 0C114.1 0 64 50.1 64 112l0 164.4c0 .1-.1 .3-.2 .6c-.2 .6-.8 1.6-1.7 2.8C43.2 304.2 32 334.8 32 368c0 79.5 64.5 144 144 144s144-64.5 144-144c0-33.2-11.2-63.8-30.1-88.1c-.9-1.2-1.5-2.2-1.7-2.8c-.1-.3-.2-.5-.2-.6L288 112C288 50.1 237.9 0 176 0zm0 416c26.5 0 48-21.5 48-48c0-20.9-13.4-38.7-32-45.3l0-50.7c0-8.8-7.2-16-16-16s-16 7.2-16 16l0 50.7c-18.6 6.6-32 24.4-32 45.3c0 26.5 21.5 48 48 48zm336-64l-32 0 0-288c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 288-32 0c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l64 64c6 6 14.1 9.4 22.6 9.4s16.6-3.4 22.6-9.4l64-64c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8z" />
          </svg>
        </span>
        <p class="text-gray-600 font-medium"><strong>Cool Time:</strong> {{ recipe.cool_time|duration_format }}</p>
      </div>
      {% endif %} {% if recipe.total_time %}
      <div class="flex items-center space-x-2">
        <span class="text-sepia-light">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="16" height="16" viewBox="0 0 16 16">
            <g class="nc-icon-wrapper" fill="currentColor" transform="translate(1.5999999999999996 1.5999999999999996) scale(0.8)"><path fill="currentColor" d="M15,2c0.6,0,1-0.4,1-1s-0.4-1-1-1H1C0.4,0,0,0.4,0,1s0.4,1,1,1h1c0.1,2.4,0.8,4.5,2,6c-1.2,1.4-2,3.6-2,6H1 c-0.6,0-1,0.4-1,1s0.4,1,1,1h14c0.6,0,1-0.4,1-1s-0.4-1-1-1h-1c-0.1-2.5-0.8-4.6-2-6c1.3-1.5,2-3.6,2-6H15z M9.9,7.3L9,8.1l1,0.7 c1.2,0.9,2,2.9,2.1,5.2H4c0.1-2.3,0.9-4.3,2.1-5.2l1-0.7L6.1,7.3C4.8,6.1,4.1,4.2,4,2h8C11.9,4.2,11.2,6.1,9.9,7.3z"></path></g>
          </svg>
        </span>
        <p class="text-gray-600 font-medium"><strong>Total Time:</strong> {{ recipe.total_time|duration_format }}</p>
      </div>

      {% endif %}
    </div>
  </div>

  <!-- Recipe Image (Positioned in the top-right corner) -->
  {% if recipe.image %}
  <div class="flex flex-col items-center justify-center w-full md:w-auto p-2">
    <div><img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" class="w-[330px] h-[330px] object-cover rounded-md" /></div>
    <!-- Extra info  -->
    <div>
      <section class="mt-2 text-center">
        <p class="text-gray-700">Author : {{ recipe.author }}</p>
        <p class="text-gray-700">Source : {{ recipe.source }}</p>
        {% comment %}
        <p class="text-gray-700">Video Link : {{ recipe.video_url }}</p>
        {% endcomment %}
      </section>
    </div>
  </div>
  {% endif %}
</div>

<!-- Ingredients -->
<div class="flex flex-col md:flex-row justify-between mb-10">
  <div class="bg-sepia-100 shadow-md rounded-lg p-4 md:p-6 relative w-full md:w-2/3 md:mr-10 mb-6 md:mb-0">
    <section class="mb-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-bold text-gray-900">Ingredients</h2>
        <div class="flex items-center justify-between space-x-4 mb-4">
          <!-- Minus Button -->
          <button onclick="updateServings(-1)" class="bg-orange-200 hover:bg-orange-300 text-gray-800 font-bold py-1 px-3 rounded-full" aria-label="Decrease Servings">-</button>

          <!-- Servings Display -->
          <p id="servings" class="text-xl text-gray-800">{{ recipe.servings }}</p>

          <!-- Plus Button -->
          <button onclick="updateServings(1)" class="bg-orange-200 hover:bg-orange-300 text-gray-800 font-bold py-1 px-3 rounded-full" aria-label="Increase Servings">+</button>
        </div>
      </div>
    </section>

    <section>
      <!-- Ingredients Grid -->
      {% if recipe.ingredientsCategories %}
      <div class="grid grid-cols-1 gap-4 md:gap-10 p-2 md:p-4">
        {% for category in recipe.ingredientsCategories %}
        <div class="flex flex-col space-y-3">
          <!-- Category Title -->
          {% if category %}
          <h3 class="text-lg italic font-bold text-gray-600 lg:text-left">{{ category }}</h3>
          {% endif %}

          <!-- Ingredients List -->
          <ul class="list-disc pl-6 space-y-2">
            {% for ingredient in recipe.ingredients %} {% if ingredient.groupName == category %}
            <li class="text-gray-700">
              <span class="ingredient-quantity" data-quantity="{{ ingredient.quantity }}" data-servings="{{ recipe.servings }}"> {{ ingredient.quantity |floatformat:"-2" }} </span>
              {{ ingredient.unit }}

              <span class="ingredient-name"> of {{ ingredient.ingredient.name }}</span>
            </li>
            {% endif %} {% endfor %}
          </ul>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <!-- No Categories: Grid of Ingredients -->
      <ul class="list-disc pl-6 space-y-1">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-3">
          {% for ingredient in recipe.ingredients %} {% if ingredient.groupName == category %}
          <li class="text-gray-700">
            <span class="ingredient-quantity" data-quantity="{{ ingredient.quantity }}" data-servings="{{ recipe.servings }}"> {{ ingredient.quantity |floatformat:"-2" }} </span>
            {{ ingredient.unit }}

            <span class="ingredient-name"> of {{ ingredient.ingredient.name }}</span>
          </li>
          {% endif %} {% endfor %}
        </div>
      </ul>
      {% endif %}
    </section>
  </div>

  <div class="w-full md:w-1/3 flex flex-col items-center">
    <!-- Equipment -->
    {% if recipe.equipment_list %}
    <div class="bg-sepia-100 shadow-md rounded-lg p-4 md:p-6 w-full mb-6">
      <section class="mb-2">
        <h2 class="text-2xl font-semibold text-gray-800 mb-4">Equipment</h2>
        <ul class="list-disc flex flex-wrap gap-6 pl-6">
          {% for equipment in recipe.equipment_list %}
          <li class="text-gray-700">{{ equipment }}</li>
          {% endfor %}
        </ul>
      </section>
    </div>
    {% endif %}

    <div class="bg-sepia-100 shadow-md rounded-lg p-4 md:p-6 w-full">
      <!-- Nutritional Section Header -->
      <section class="mb-6">
        <div class="flex items-center justify-between">
          <h2 class="text-2xl font-semibold text-gray-800">Nutritional Information</h2>

          <!-- Expand/Collapse Button -->
          <button id="toggleNutrition" class="bg-orange-200 hover:bg-orange-300 text-gray-800 font-bold py-1 px-3 rounded-full flex items-center" onclick="toggleNutrition()">
            <span id="toggleIcon" class="transition-transform transform rotate-0">&#9660;</span>
          </button>
        </div>
        <h2 class="text-sm ml-6 text-gray-700">/ per serving</h2>
      </section>

      <!-- Nutritional Details -->
      <div id="nutritionDetails" class="hidden space-y-3">
        {% comment %} Basic fields {% endcomment %} {% if recipe.nutrition.calories != 0 %}
        <div class="flex justify-between border-b pb-1">
          <span class="text-gray-700">Calories</span>
          <span class="font-semibold text-gray-900">{{ recipe.nutrition.calories|floatformat:"-2" }} kcal</span>
        </div>
        {% endif %} {% if recipe.nutrition.carbohydrates != 0 %}
        <div class="flex justify-between border-b pb-1">
          <span class="text-gray-700">Carbohydrate</span>
          <span class="font-semibold text-gray-900">{{ recipe.nutrition.carbohydrates|floatformat:"-2" }} g</span>
        </div>
        {% endif %} {% if recipe.nutrition.protein != 0 %}
        <div class="flex justify-between border-b pb-1">
          <span class="text-gray-700">Protein</span>
          <span class="font-semibold text-gray-900">{{ recipe.nutrition.protein|floatformat:"-2" }} g</span>
        </div>
        {% endif %} {% if recipe.nutrition.fat != 0 %}
        <div class="flex justify-between border-b pb-1">
          <span class="text-gray-700">Fat</span>
          <span class="font-semibold text-gray-900">{{ recipe.nutrition.fat|floatformat:"-2" }} g</span>
        </div>
        {% endif %} {% if recipe.nutrition.saturated_fat != 0 %}
        <div class="flex justify-between border-b pb-1">
          <span class="text-gray-700">Saturated Fat</span>
          <span class="font-semibold text-gray-900">{{ recipe.nutrition.saturated_fat|floatformat:"-2" }} g</span>
        </div>
        {% endif %} {% if recipe.nutrition.trans_fat != 0 %}
        <div class="flex justify-between border-b pb-1">
          <span class="text-gray-700">Trans Fat</span>
          <span class="font-semibold text-gray-900">{{ recipe.nutrition.trans_fat|floatformat:"-2" }} g</span>
        </div>
        {% endif %} {% if recipe.nutrition.fiber != 0 %}
        <div class="flex justify-between border-b pb-1">
          <span class="text-gray-700">Fiber</span>
          <span class="font-semibold text-gray-900">{{ recipe.nutrition.fiber|floatformat:"-2" }} g</span>
        </div>
        {% endif %} {% if recipe.nutrition.sugar != 0 %}
        <div class="flex justify-between border-b pb-1">
          <span class="text-gray-700">Sugar</span>
          <span class="font-semibold text-gray-900">{{ recipe.nutrition.sugar|floatformat:"-2" }} g</span>
        </div>
        {% endif %}

        <div class="border-b pb-1">
          {% comment %} Minerals {% endcomment %}
          <h3 class="text-sm font-semibold text-gray-700 pb-2">Minerals / Vitamins</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-y-2 gap-x-4 text-sm text-gray-600">
            {% if recipe.nutrition.sodium != 0 %}
            <div class="flex justify-between">
              <span>Sodium</span>
              <span class="font-medium font-semibold text-gray-700">{{recipe.nutrition.sodium|floatformat:"-2"}} mg</span>
            </div>
            {% endif %} {% if recipe.nutrition.vitamin_a != 0 %}
            <div class="flex justify-between">
              <span>Vitamin A</span>
              <span class="font-medium font-semibold text-gray-700">{{recipe.nutrition.vitamin_a |floatformat:"-2"}} mg</span>
            </div>
            {% endif %} {% if recipe.nutrition.cholesterol != 0 %}
            <div class="flex justify-between">
              <span>Cholesterol</span>
              <span class="font-medium font-semibold text-gray-700">{{recipe.nutrition.cholesterol |floatformat:"-2"}} mg</span>
            </div>
            {% endif %} {% if recipe.nutrition.vitamin_c != 0 %}
            <div class="flex justify-between">
              <span>Vitamin C</span>
              <span class="font-medium font-semibold text-gray-700">{{recipe.nutrition.vitamin_c |floatformat:"-2"}} mg</span>
            </div>
            {% endif %} {% if recipe.nutrition.potassium != 0 %}
            <div class="flex justify-between">
              <span>Potassium</span>
              <span class="font-medium font-semibold text-gray-700">{{recipe.nutrition.potassium |floatformat:"-2"}} mg</span>
            </div>
            {% endif %} {% if recipe.nutrition.calcium != 0 %}
            <div class="flex justify-between">
              <span>Calcium</span>
              <span class="font-medium font-semibold text-gray-700">{{recipe.nutrition.calcium |floatformat:"-2"}} mg</span>
            </div>
            {% endif %} {% if recipe.nutrition.iron != 0 %}
            <div class="flex justify-between">
              <span>Iron</span>
              <span class="font-medium font-semibold text-gray-700">{{recipe.nutrition.iron |floatformat:"-2"}} mg</span>
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Disclaimer -->
      <p class="mt-4 text-sm text-gray-600">The nutritional values provided are generated using an algorithm and are approximate. They may vary depending on the specific ingredients you use and their unique characteristics.</p>
    </div>
  </div>

  <script>
    function toggleNutrition() {
      const nutritionDetails = document.getElementById("nutritionDetails");
      const toggleIcon = document.getElementById("toggleIcon");

      // Toggle visibility and rotate icon
      if (nutritionDetails.classList.contains("hidden")) {
        nutritionDetails.classList.remove("hidden");
        toggleIcon.classList.add("rotate-180");
      } else {
        nutritionDetails.classList.add("hidden");
        toggleIcon.classList.remove("rotate-180");
      }
    }
  </script>
</div>

<script>
  // JavaScript Function to Update Servings and Ingredient Quantities
  function updateServings(change) {
    const servingsElement = document.getElementById("servings");
    let currentServings = parseInt(servingsElement.textContent, 10);

    // Update servings (ensure no negative values)
    const newServings = Math.max(1, currentServings + change);

    // Update the DOM for servings
    servingsElement.textContent = newServings;

    // Update each ingredient's quantity
    const ingredientQuantities = document.querySelectorAll(".ingredient-quantity");
    ingredientQuantities.forEach((quantityElement) => {
      const baseQuantity = parseFloat(quantityElement.dataset.quantity); // Original quantity
      if (isNaN(baseQuantity)) return;
      const baseServings = parseInt(quantityElement.dataset.servings, 10); // Original servings
      const newQuantity = ((baseQuantity / baseServings) * newServings).toFixed(2); // Adjust quantity
      quantityElement.textContent = newQuantity; // Update the displayed quantity
    });
  }
</script>

<div class="bg-sepia-100 shadow-md rounded-lg p-4 md:p-10 relative w-full mb-10">
  <!-- Instructions -->
  <section class="mb-6">
    <!-- Section Title -->
    <h2 class="text-3xl font-bold text-gray-800 mb-6 text-left">Instructions</h2>
    <!-- Instructions List -->
    <ol class="space-y-6 md:p-2">
      {% for instruction in recipe.instructions_list %} {% if ':' in instruction.1 %}
      <!-- Group Heading -->
      <li class="text-xl font-bold text-gray-900 bg-orange-100 md:p-4 rounded-lg text-center">{{ instruction.1 }}</li>
      {% else %}
      <!-- Individual Instruction -->
      <li class="flex flex-row items-center items-start space-x-2 text-gray-700 p-2 rounded-lg">
        <!-- Step Number -->
        <span class="bg-orange-300 text-gray-900 text-xl rounded-full font-bold w-10 md:h-10 flex items-center justify-center m-2 md:m-4"> {{ instruction.0 }} </span>
        <!-- Instruction Text -->
        <span class="w-11/12 text-left">{{ instruction.1 }}</span>
      </li>
      {% endif %} {% endfor %}
    </ol>
  </section>
</div>

{% if recipe.notes_list %}
<div class="bg-sepia-100 shadow-md rounded-lg p-10 relative w-full">
  <!-- Notes -->

  <section class="mb-6">
    <h2 class="text-3xl font-bold text-gray-800 mb-6 text-left">Notes</h2>

    <ul class="list-disc pl-6 space-y-3 mb-2">
      {% for note in recipe.notes_list %}
      <li class="text-gray-700">{{ note }}</li>
      {% endfor %}
    </ul>
  </section>
</div>
{% endif %} {% endblock %}
