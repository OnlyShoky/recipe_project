{% extends 'base.html' %} {% load custom_filters %} {% block title %}{{ recipe.title }}{% endblock %} {% block content %}
<div class="bg-white shadow-md rounded-lg p-6 mb-8 flex flex-row justify-between">
  <!-- Recipe Information (Title, Description, Tags, Times) -->
  <div>
    <!-- Recipe Title -->
    <h1 class="text-3xl font-bold text-gray-800 mb-4">{{ recipe.title }}</h1>

    <!-- Metadata -->
    <p class="text-sm text-gray-500 mb-4">Published: {{ recipe.activate_date|date:"F d, Y" }}</p>

    <!-- Recipe Description -->
    <p class="text-gray-700 mb-6">{{ recipe.description }}</p>

    <!-- Course and Cuisine -->
    <div class="flex flex-col mb-6">
      <div class="flex items-center space-x-2 mb-3">
        <span class="text-sepia-light">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" x="0px" y="0px" width="16px" height="16px" viewBox="25 0 500 550"><path fill="currentColor" d="M0 192c0-35.3 28.7-64 64-64c.5 0 1.1 0 1.6 0C73 91.5 105.3 64 144 64c15 0 29 4.1 40.9 11.2C198.2 49.6 225.1 32 256 32s57.8 17.6 71.1 43.2C339 68.1 353 64 368 64c38.7 0 71 27.5 78.4 64c.5 0 1.1 0 1.6 0c35.3 0 64 28.7 64 64c0 11.7-3.1 22.6-8.6 32L8.6 224C3.1 214.6 0 203.7 0 192zm0 91.4C0 268.3 12.3 256 27.4 256l457.1 0c15.1 0 27.4 12.3 27.4 27.4c0 70.5-44.4 130.7-106.7 154.1L403.5 452c-2 16-15.6 28-31.8 28l-231.5 0c-16.1 0-29.8-12-31.8-28l-1.8-14.4C44.4 414.1 0 353.9 0 283.4z" /></svg>
        </span>
        <p class="text-gray-600 font-medium"><strong>Course:</strong> {{ recipe.courses.all | join:', ' }}</p>
      </div>
      <div class="flex items-center space-x-2 mb-3">
        <span class="text-sepia-light">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" x="0px" y="0px" width="16px" height="16px" viewBox="25 0 500 550">
            <path fill="currentColor" d="M57.7 193l9.4 16.4c8.3 14.5 21.9 25.2 38 29.8L163 255.7c17.2 4.9 29 20.6 29 38.5l0 39.9c0 11 6.2 21 16 25.9s16 14.9 16 25.9l0 39c0 15.6 14.9 26.9 29.9 22.6c16.1-4.6 28.6-17.5 32.7-33.8l2.8-11.2c4.2-16.9 15.2-31.4 30.3-40l8.1-4.6c15-8.5 24.2-24.5 24.2-41.7l0-8.3c0-12.7-5.1-24.9-14.1-33.9l-3.9-3.9c-9-9-21.2-14.1-33.9-14.1L257 256c-11.1 0-22.1-2.9-31.8-8.4l-34.5-19.7c-4.3-2.5-7.6-6.5-9.2-11.2c-3.2-9.6 1.1-20 10.2-24.5l5.9-3c6.6-3.3 14.3-3.9 21.3-1.5l23.2 7.7c8.2 2.7 17.2-.4 21.9-7.5c4.7-7 4.2-16.3-1.2-22.8l-13.6-16.3c-10-12-9.9-29.5 .3-41.3l15.7-18.3c8.8-10.3 10.2-25 3.5-36.7l-2.4-4.2c-3.5-.2-6.9-.3-10.4-.3C163.1 48 84.4 108.9 57.7 193zM464 256c0-36.8-9.6-71.4-26.4-101.5L412 164.8c-15.7 6.3-23.8 23.8-18.5 39.8l16.9 50.7c3.5 10.4 12 18.3 22.6 20.9l29.1 7.3c1.2-9 1.8-18.2 1.8-27.5zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256z" />
          </svg>
        </span>
        <p class="text-gray-600 font-medium"><strong>Cuisine:</strong> {{ recipe.cuisines.all | join:', ' }}</p>
      </div>
      <div class="flex items-center space-x-2 mb-3">
        <span class="text-sepia-light">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" x="0px" y="0px" width="16px" height="16px" viewBox="25 0 500 550">
            <path fill="currentColor" d="M345 39.1L472.8 168.4c52.4 53 52.4 138.2 0 191.2L360.8 472.9c-9.3 9.4-24.5 9.5-33.9 .2s-9.5-24.5-.2-33.9L438.6 325.9c33.9-34.3 33.9-89.4 0-123.7L310.9 72.9c-9.3-9.4-9.2-24.6 .2-33.9s24.6-9.2 33.9 .2zM0 229.5L0 80C0 53.5 21.5 32 48 32l149.5 0c17 0 33.3 6.7 45.3 18.7l168 168c25 25 25 65.5 0 90.5L277.3 442.7c-25 25-65.5 25-90.5 0l-168-168C6.7 262.7 0 246.5 0 229.5zM144 144a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z" />
          </svg>
        </span>
        <p class="text-gray-600 font-medium"><strong>Tags:</strong></p>
        {% for tag in recipe.tags.all %}
        <!-- Limit to 8 ingredients -->
        <a href="{% url 'recipe_list' %}?tag={{ tag.name|slugify }}" class="transform transition-transform hover:scale-105">
          <div class="bg-gray-300 px-2 py-0.5 shadow rounded-lg text-center hover:shadow-lg transition-shadow flex items-center justify-center">
            <p class="text-black font-semibold">{{ tag | title }}</p>
          </div>
        </a>
        {% endfor %}
      </div>
    </div>

    <!-- Times (Prep, Cook, Cool, Total) -->
    <div class="grid grid-cols-2 gap-2 mb-6">
      {% if recipe.prep_time %}
      <div class="flex items-center space-x-2">
        <span class="text-sepia-light">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="16px" height="16px" viewBox="0 0 24 24">
            <g>
              <path fill="currentColor" d="M4.3,16.6l-2.2,2.2c-0.6,0.6-0.9,1.3-0.9,2.1c0,0.8,0.3,1.6,0.9,2.1s1.3,0.9,2.1,0.9c0.8,0,1.6-0.3,2.1-0.9l2.2-2.2L4.3,16.6z"></path>
              <path fill="currentColor" d="M22.6,5.4l-3.5-3.5c-1.1-1.1-2.6-1.8-4.2-1.8s-3.1,0.6-4.2,1.8l-8.4,8.4c-0.4,0.4-0.4,1,0,1.4l7.1,7.1C9.5,18.9,9.7,19,10,19c0,0,0,0,0,0c0.3,0,0.5-0.1,0.7-0.3L22.6,6.8C23,6.4,23,5.8,22.6,5.4z M9.2,14.6l-1.4-1.4l6.4-6.4l1.4,1.4L9.2,14.6z"></path>
            </g>
          </svg>
        </span>
        <p class="text-gray-600 font-medium"><strong>Prep Time:</strong> {{ recipe.prep_time|duration_format }}</p>
      </div>
      {% endif %} {% if recipe.cook_time %}

      <div class="flex items-center space-x-2">
        <span class="text-sepia-light">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="16px" height="16px" viewBox="0 0 24 24">
            <g>
              <path fill="currentColor" d="M9,9c0.6,0,1-0.4,1-1V4c0-0.6-0.4-1-1-1S8,3.4,8,4v4C8,8.6,8.4,9,9,9z"></path>
              <path fill="currentColor" d="M4,12c0.6,0,1-0.4,1-1V7c0-0.6-0.4-1-1-1S3,6.4,3,7v4C3,11.6,3.4,12,4,12z"></path>
              <path fill="currentColor" d="M14,12c0.6,0,1-0.4,1-1V7c0-0.6-0.4-1-1-1s-1,0.4-1,1v4C13,11.6,13.4,12,14,12z"></path>
              <path fill="currentColor" d="M23,14h-5H1c-0.6,0-1,0.4-1,1v3c0,1.7,1.3,3,3,3h13c1.7,0,3-1.3,3-3v-1h4c0.6,0,1-0.4,1-1v-1C24,14.4,23.6,14,23,14z"></path>
            </g>
          </svg>
        </span>
        <p class="text-gray-600 font-medium"><strong>Cook Time:</strong> {{ recipe.cook_time|duration_format }}</p>
      </div>
      {% endif %} {% if recipe.cool_time %}
      <div class="flex items-center space-x-2">
        <span class="text-sepia-light">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" x="0px" y="0px" width="16px" height="16px" viewBox="25 0 500 550">
            <path fill="currentColor" d="M128 112c0-26.5 21.5-48 48-48s48 21.5 48 48l0 164.5c0 17.3 7.1 31.9 15.3 42.5C249.8 332.6 256 349.5 256 368c0 44.2-35.8 80-80 80s-80-35.8-80-80c0-18.5 6.2-35.4 16.7-48.9c8.2-10.6 15.3-25.2 15.3-42.5L128 112zM176 0C114.1 0 64 50.1 64 112l0 164.4c0 .1-.1 .3-.2 .6c-.2 .6-.8 1.6-1.7 2.8C43.2 304.2 32 334.8 32 368c0 79.5 64.5 144 144 144s144-64.5 144-144c0-33.2-11.2-63.8-30.1-88.1c-.9-1.2-1.5-2.2-1.7-2.8c-.1-.3-.2-.5-.2-.6L288 112C288 50.1 237.9 0 176 0zm0 416c26.5 0 48-21.5 48-48c0-20.9-13.4-38.7-32-45.3l0-50.7c0-8.8-7.2-16-16-16s-16 7.2-16 16l0 50.7c-18.6 6.6-32 24.4-32 45.3c0 26.5 21.5 48 48 48zm336-64l-32 0 0-288c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 288-32 0c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l64 64c6 6 14.1 9.4 22.6 9.4s16.6-3.4 22.6-9.4l64-64c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8z" />
          </svg>
        </span>
        <p class="text-gray-600 font-medium"><strong>Cool Time:</strong> {{ recipe.cool_time|duration_format }}</p>
      </div>
      {% endif %} {% if recipe.total_time %}
      <div class="flex items-center space-x-2">
        <span class="text-sepia-light">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="16" height="16" viewBox="0 0 16 16">
            <g class="nc-icon-wrapper" fill="currentColor" transform="translate(1.5999999999999996 1.5999999999999996) scale(0.8)"><path fill="currentColor" d="M15,2c0.6,0,1-0.4,1-1s-0.4-1-1-1H1C0.4,0,0,0.4,0,1s0.4,1,1,1h1c0.1,2.4,0.8,4.5,2,6c-1.2,1.4-2,3.6-2,6H1 c-0.6,0-1,0.4-1,1s0.4,1,1,1h14c0.6,0,1-0.4,1-1s-0.4-1-1-1h-1c-0.1-2.5-0.8-4.6-2-6c1.3-1.5,2-3.6,2-6H15z M9.9,7.3L9,8.1l1,0.7 c1.2,0.9,2,2.9,2.1,5.2H4c0.1-2.3,0.9-4.3,2.1-5.2l1-0.7L6.1,7.3C4.8,6.1,4.1,4.2,4,2h8C11.9,4.2,11.2,6.1,9.9,7.3z"></path></g>
          </svg>
        </span>
        <p class="text-gray-600 font-medium"><strong>Total Time:</strong> {{ recipe.total_time|duration_format }}</p>
      </div>

      {% endif %}
    </div>
  </div>

  <!-- Recipe Image (Positioned in the top-right corner) -->
  {% if recipe.image %}
  <div class="flex flex-col items-center justify-center">
    <div><img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" class="w-[330px] h-[330px] object-cover rounded-md" /></div>
    <!-- Extra info  -->
    <div>
      <section class="mt-2 text-center">
        <p class="text-gray-700">Author : {{ recipe.author }}</p>
        <p class="text-gray-700">Source : {{ recipe.source }}</p>
        {% comment %}
        <p class="text-gray-700">Video Link : {{ recipe.video_url }}</p>
        {% endcomment %}
      </section>
    </div>
  </div>
  {% endif %}
</div>

<!-- Ingredients -->
<div class="flex flex-row justify-between mb-10">
  <div class="bg-white shadow-md rounded-lg p-6 relative w-2/3 mr-10">
    <section class="mb-6">
      <div class="flex items-center justify-between space-x-40 mb-4">
        <h2 class="text-2xl font-bold text-gray-900">Ingredients</h2>
        <div class="flex items-center space-x-2">
          <!-- Minus Button -->
          <button onclick="updateServings(-1)" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-1 px-3 rounded-full" aria-label="Decrease Servings">-</button>

          <!-- Servings Display -->
          <p id="servings" class="text-xl text-gray-800">{{ recipe.servings }}</p>

          <!-- Plus Button -->
          <button onclick="updateServings(1)" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-1 px-3 rounded-full" aria-label="Increase Servings">+</button>
        </div>
      </div>


      <section>
        <!-- Ingredients Grid -->
        {% if recipe.ingredientsCategories %}
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 p-4">
          {% for category in recipe.ingredientsCategories %}
          <div class="flex flex-col space-y-3">
            <!-- Category Title -->
            {% if category %}
            <h3 class="text-lg italic font-bold text-gray-600 lg:text-left">{{ category }}</h3>
            {% endif %}
      
            <!-- Ingredients List -->
            <ul class="list-disc pl-6 space-y-2">
                {% for ingredient in recipe.ingredients %} {% if ingredient.groupName == category %}
                <li class="text-gray-700">
                  <span class="ingredient-quantity" data-quantity="{{ ingredient.quantity }}" data-servings="{{ recipe.servings }}"> {{ ingredient.quantity |floatformat:"-2" }} </span>
                  {{ ingredient.unit }}
    
                  <span class="ingredient-name"> of {{ ingredient.ingredient.name }}</span>
                </li>
                {% endif %} {% endfor %}
            </ul>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <!-- No Categories: Grid of Ingredients -->
        <ul class="list-disc pl-6 space-y-1">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-3">
            {% for ingredient in recipe.ingredients %} {% if ingredient.groupName == category %}
            <li class="text-gray-700">
              <span class="ingredient-quantity" data-quantity="{{ ingredient.quantity }}" data-servings="{{ recipe.servings }}"> {{ ingredient.quantity |floatformat:"-2" }} </span>
              {{ ingredient.unit }}

              <span class="ingredient-name"> of {{ ingredient.ingredient.name }}</span>
            </li>
            {% endif %} {% endfor %}
          </div>
        </ul>
        {% endif %}
      </section>
      
      
  </div>

  <div class="w-1/3 h-1/3 flex flex-col items-center">
    <!-- Equipment -->
    {% if recipe.equipment_list %}
    <div class="bg-white shadow-md rounded-lg p-6 w-full mb-6">
      <section class="mb-2">
        <h2 class="text-2xl font-semibold text-gray-800 mb-4">Equipment</h2>
        <ul class="list-disc flex flex-wrap gap-6 pl-6">
          {% for equipment in recipe.equipment_list %}
          <li class="text-gray-700">{{ equipment }}</li>
          {% endfor %}
        </ul>
      </section>
    </div>
    {% endif %}

    <div class="bg-white shadow-md rounded-lg p-6">
      <!-- Nutritional Section Header -->
      <section class="mb-6">
        <div class="flex items-center justify-between">
          <h2 class="text-2xl font-semibold text-gray-800">Nutritional Information</h2>
          <!-- Expand/Collapse Button -->
          <button id="toggleNutrition" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-1 px-3 rounded-full flex items-center" onclick="toggleNutrition()">
            <span id="toggleIcon" class="transition-transform transform rotate-0">&#9660;</span>
          </button>
        </div>
      </section>

      <!-- Nutritional Details -->
      <div id="nutritionDetails" class="hidden space-y-4">
        <div class="flex justify-between border-b pb-2">
          <span class="text-gray-700">Energy (kJ)</span>
          <span class="font-semibold text-gray-900">0 kJ</span>
        </div>
        <div class="flex justify-between border-b pb-2">
          <span class="text-gray-700">Calories</span>
          <span class="font-semibold text-gray-900">545 kcal</span>
        </div>
        <div class="flex justify-between border-b pb-2">
          <span class="text-gray-700">Fat</span>
          <span class="font-semibold text-gray-900">17 g</span>
        </div>
        <div class="flex justify-between border-b pb-2">
          <span class="text-gray-700">Saturated Fat</span>
          <span class="font-semibold text-gray-900">5 g</span>
        </div>
        <div class="flex justify-between border-b pb-2">
          <span class="text-gray-700">Carbohydrate</span>
          <span class="font-semibold text-gray-900">46 g</span>
        </div>
        <div class="flex justify-between border-b pb-2">
          <span class="text-gray-700">Sugar</span>
          <span class="font-semibold text-gray-900">6 g</span>
        </div>
        <div class="flex justify-between border-b pb-2">
          <span class="text-gray-700">Dietary Fiber</span>
          <span class="font-semibold text-gray-900">7 g</span>
        </div>
        <div class="flex justify-between border-b pb-2">
          <span class="text-gray-700">Protein</span>
          <span class="font-semibold text-gray-900">52 g</span>
        </div>
        <div class="flex justify-between border-b pb-2">
          <span class="text-gray-700">Cholesterol</span>
          <span class="font-semibold text-gray-900">114 mg</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-700">Sodium</span>
          <span class="font-semibold text-gray-900">355 mg</span>
        </div>
      </div>

      <!-- Disclaimer -->
      <p class="mt-4 text-sm text-gray-600">The nutritional values provided are generated using an algorithm and are approximate. They may vary depending on the specific ingredients you use and their unique characteristics.</p>
    </div>
  </div>

  <script>
    function toggleNutrition() {
      const nutritionDetails = document.getElementById("nutritionDetails");
      const toggleIcon = document.getElementById("toggleIcon");

      // Toggle visibility and rotate icon
      if (nutritionDetails.classList.contains("hidden")) {
        nutritionDetails.classList.remove("hidden");
        toggleIcon.classList.add("rotate-180");
      } else {
        nutritionDetails.classList.add("hidden");
        toggleIcon.classList.remove("rotate-180");
      }
    }
  </script>
</div>

<script>
  // JavaScript Function to Update Servings and Ingredient Quantities
  function updateServings(change) {
    const servingsElement = document.getElementById("servings");
    let currentServings = parseInt(servingsElement.textContent, 10);

    // Update servings (ensure no negative values)
    const newServings = Math.max(1, currentServings + change);

    // Update the DOM for servings
    servingsElement.textContent = newServings;

    // Update each ingredient's quantity
    const ingredientQuantities = document.querySelectorAll(".ingredient-quantity");
    ingredientQuantities.forEach((quantityElement) => {
      const baseQuantity = parseFloat(quantityElement.dataset.quantity); // Original quantity
      if (isNaN(baseQuantity)) return;
      const baseServings = parseInt(quantityElement.dataset.servings, 10); // Original servings
      const newQuantity = ((baseQuantity / baseServings) * newServings).toFixed(2); // Adjust quantity
      quantityElement.textContent = newQuantity; // Update the displayed quantity
    });
  }
</script>

<div class="bg-white shadow-md rounded-lg p-6 relative w-full">
  <!-- Instructions -->
  <section class="mb-6">
    <!-- Section Title -->
    <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Instructions</h2>
    <!-- Instructions List -->
    <ol class="space-y-6">
      {% for instruction in recipe.instructions_list %}
        {% if ':' in instruction.1 %}
        <!-- Group Heading -->
        <li class="text-xl font-bold text-gray-900 bg-gray-200 p-4 rounded-lg">
          {{ instruction.1 }}
        </li>
        {% else %}
        <!-- Individual Instruction -->
        <li class="flex flex-row items-center items-start space-x-2 text-gray-700 bg-gray-50 p-2 rounded-lg shadow-sm">
          <!-- Step Number -->
          <span class="bg-gray-300 text-gray-900 text-xl rounded-full font-bold w-10 h-10 flex items-center justify-center m-4">
            {{ instruction.0 }}
          </span>
          <!-- Instruction Text -->
          <span class="w-11/12 text-left">{{ instruction.1 }}</span>
        </li>
        {% endif %}
      {% endfor %}
    </ol>
  </section>





  <!-- Notes -->
  {% if recipe.notes_list %}
  <section class="mb-6">
    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Notes</h2>
    <ul class="list-disc pl-6 space-y-1 mb-2">
      {% for note in recipe.notes_list %}
      <li class="text-gray-700">{{ note }}</li>
      {% endfor %}
    </ul>
  </section>
  {% endif %}
</div>

{% endblock %}
